/*
 * Copyright (c) 2017 Linaro Limited
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#include <zephyr.h>
#include <device.h>
#include <gpio.h>
#include <misc/printk.h>
#include <misc/__assert.h>
#include <string.h>

#include "WM8976.h"
#include "s3c2440_i2s.h"

#define PORT0	 LED0_GPIO_CONTROLLER
#define PORT1	 LED1_GPIO_CONTROLLER

/* Change this if you have an LED connected to a custom pin */
#define LED0    LED0_GPIO_PIN
#define LED1    LED1_GPIO_PIN

/* 44.1K fs 800hz stereo 正弦波，一个周期数据 */
static const signed short sin_data[] = {
	0x0000,  0x0000,  0x0E8E,  0x0E8E,  0x1CED,  0x1CED,  0x2AEB,  0x2AEB,  
	0x385B,  0x385B,  0x450F,  0x4510,  0x50DE,  0x50DF,  0x5BA1,  0x5BA1,  
	0x6533,  0x6532,  0x6D74,  0x6D74,  0x744A,  0x744B,  0x799E,  0x799F,  
	0x7D5E,  0x7D5E,  0x7F7D,  0x7F7D,  0x7FF5,  0x7FF5,  0x7EC3,  0x7EC4,  
	0x7BEC,  0x7BED,  0x777A,  0x777B,  0x717C,  0x717B,  0x6A03,  0x6A03,  
	0x612A,  0x612B,  0x570F,  0x570F,  0x4BD3,  0x4BD3,  0x3F9A,  0x3F9A,  
	0x328F,  0x328F,  0x24DC,  0x24DC,  0x16AD,  0x16AC,  0x0833,  0x0833,  
	0xF99F,  0xF99F,  0xEB1F,  0xEB1F,  0xDCE5,  0xDCE5,  0xCF1F,  0xCF20,  
	0xC1FD,  0xC1FC,  0xB5A7,  0xB5A7,  0xAA49,  0xAA49,  0xA008,  0xA008,  
	0x9705,  0x9706,  0x8F60,  0x8F60,  0x8930,  0x8930,  0x848B,  0x848B,  
	0x8181,  0x8180,  0x801A,  0x801A,  0x805C,  0x805D,  0x8247,  0x8247,  
	0x85D3,  0x85D4,  0x8AF5,  0x8AF5,  0x919C,  0x919C,  0x99B2,  0x99B2,  
	0xA31B,  0xA31B,  0xADBA,  0xADBA,  0xB969,  0xB96A,  0xC603,  0xC603,  
	0xD35E,  0xD35F,  0xE14D,  0xE14D,  0xEFA2,  0xEFA2, 
};
#define SIN_DATA_LEN  (sizeof(sin_data)/sizeof(sin_data[0]))    

short next_sin_data(void)
{
    static int next = -1;

    next++;
    next = next % SIN_DATA_LEN;

    return sin_data[next];
}

void main(void)
{
    struct device *gpio_dev;
    int i = 0;

    printk("boot main %d\n", sizeof(signed short));

	gpio_dev = device_get_binding(PORT0);

	gpio_pin_configure(gpio_dev, LED0, GPIO_DIR_OUT);

    init_wm8976();
    init_IIS_bus(44100);
    

	while (1) {

        fill_iis_data(next_sin_data);
        //gpio_pin_write(gpio_dev, LED0, cnt++ % 2); 
	}
}
